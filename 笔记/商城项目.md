#   第一天

1. Linux安装Docker

2. Docker安装MySQL、Redis

   * 出现问题：MySQL容器启动后自动关闭
   * 解决：查看Docker日志文件，然后网上搜解决方法，删除了linux系统中存在的mysql文件

3. 开发工具：前端VSCode，后端IDEA

4. 项目管理与版本控制：Maven、Github

5. 数据库设计：PowerDesigner

   * 表不设计外键

6. 创建了5个微服务（子模块）

   1. 优惠券服务
   2. 会员服务
   3. 订单服务
   4. 产品服务
   5. 仓储服务

   这五个子模块由mall主模块统一管理，通过Feign通信，每个服务管理自己的数据库

# 第二天、项目环境搭建

1. 寻找开源后台管理系统（前后端分离）——使用人人开源的后台管理系统

   1. renren-fast：后端

      SpringBoot，创建相应的数据库并修改数据库配置，然后直接运行

   2. renren-fast-vue：前端

      下载Node.js，使用npm（前端包管理工具，类似于Maven）。

      设置npm的镜像，使用淘宝的：

      ```shell
      npm config set registry http://registry.npm.taobao.org/
      ```

      运行前端项目命令

       - 在VSCode的控制台中，输入

         ```shell
         npm install#下载依赖
         npm run dev#运行前端项目
         ```

         * 错误1：在运行npm install时报错

           ![image-20200611211045168](F:\Java书和视频\笔记\商城项目\npm报错.png)

           解决：![image-20200611211148793](F:\Java书和视频\笔记\商城项目\npm错误解决.png)

         * 错误2：运行npm run dev时报错

           ![image-20200611211754701](C:\Users\wyj\AppData\Roaming\Typora\typora-user-images\image-20200611211754701.png)

           解决：

           ```shell
           首先把项目文件夹下的package.json里面的node-sass4.9.0改成4.9.2（不改可能也没关系，不过我改了，防止踩坑）
           然后项目文件夹下打开cmd命令窗口（和Visual Studio Code的终端命令是一样的）
           执行：
           npm i node-sass --sass_binary_site=https://npm.taobao.org/mirrors/node-sass/
           执行成功看看有没有报错，如果没报错执行下面命令
           npm install ，
           没报错就是安装成功，然后使用npm run dev 就ok了
           注：这么做得原理就是先单独从淘宝镜像吧nod-sass下载下来，然后再进行编译，因为这句命令好像是不成功的，（npm config set registry http://registry.npm.taobao.org/），默认从github下载，导致报错的
           如果之前安装失败的。先清理 缓存
           清理缓存：npm rebuild node-sass
           npm uninstall node-sass
           ```

           

      前后端项目同时开启后，就可以进行联调

2. 下载renren-generator（代码生成器）

   为各个微服务生成基本的**增删改查**代码

   * 修改![image-20200612211406529](F:\Java书和视频\笔记\商城项目\1.png)中的配置（具体到自己使用的数据库，项目的路径、项目名等）
   
   * 运行renren-generator，访问网址
   
     ![image-20200612211529771](F:\Java书和视频\笔记\商城项目\2.png)
   
     生成代码，然后将生成出来的main文件与原项目中的main文件替换
   
     ![image-20200612211640883](F:\Java书和视频\笔记\商城项目\3.png)
   
     ​	自动生成了controller、dao、entity和service，还有对应的mapper文件

3. 测试product子模块

   1. 整合MyBatisPlus

      ```java
      <dependency>
          <groupId>com.baomidou</groupId>
          <artifactId>mybatis-plus-boot-starter</artifactId>
          <version>3.2.0</version>
      </dependency>
      ```

   2. 配置MyBatisPlus

      1. 配置数据源

         1. 导入数据库的驱动

            ```java
            <dependency>
                <groupId>mysql</groupId>
                <artifactId>mysql-connector-java</artifactId>
                <version>8.0.17</version>
            </dependency>
            ```

         2. 配置数据源

            在application.yml中配置

            ```yml
            spring:
              datasource:
                username: root
                password: root
                url: jdbc:mysql://192.168.1.108:3306/mall_pms
                driver-class-name: com.mysql.jdbc.Driver
            ```

      2. 配置MyBatisPlus

         ```java
         //添加这个注解
         @MapperScan("com.wyjie.mall.product.dao")
         @SpringBootApplication
         public class MallProductApplication {
         
             public static void main(String[] args) {
                 SpringApplication.run(MallProductApplication.class, args);
             }
         
         }
         
         ```

         告诉MyBatis-plus，sql映射文件位置

         ```yml
         mybatis-plus:
           mapper-locations: classpath:/mapper/**/*.xml  #sql映射文件位置
           global-config:
             db-config:
               id-type: auto       #自增主键
         ```

# 第三天、Spring Cloud分布式组件

结合SpringCloud Alibaba，商城项目最终的技术搭配方案为：

```yaml
SpringCloud Alibaba - Nacos：注册中心（服务发现/注册）
SpringCloud Alibaba - Nacos：配置中心（动态配置管理）
SpringCloud - Ribbon：负载均衡
SpringCloud - Feign：声明式HTTP客户端（调用远程服务）
SpringCloud Alibaba - Sentinel：服务容错（限流、降级、熔断）
SpringCloud - GateWay：API网关（webflux编程模式）
SpringCloud - Sleuth：调用链监控
SpringCloud - Seata：分布式事务解决方案
```

## 1、使用SpringCloud Alibaba

### 1. 使用Nacos作为微服务的注册中心

查找官方文档

[SpringCloud Alibaba](https://github.com/alibaba/spring-cloud-alibaba/blob/master/README-zh.md)

[Nacos注册中心demo](https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-examples/nacos-example/nacos-discovery-example/readme-zh.md)

1. 导入Nacos依赖
2. 下载Nacos注册中心服务器
3. 运行Nacos注册中心
4. 在应用的yml文件中配置NacosServer地址
5. 使用@EnableDiscoveryClient注解，开启服务注册发现功能
6. 在应用yml中添加application.name，才能成功注册服务

#### 远程调用

使用SpringCloud Feign进行远程调用。Feign是一个声明式的HTTP客户端，它的目的久石让远程调用更加简单。

```Java
* 远程调用别的服务的步骤
* 1、引入openfeign
* 2、编写一个接口，告诉SpringCloud这个接口需要调用远程服务
*      1)声明接口的每一个方法都是调用哪个远程服务的哪个请求
* 3、开启远程调用功能   
```

![image-20200616204616567](F:\Java书和视频\笔记\商城项目\4.png)

![image-20200616204753969](F:\Java书和视频\笔记\商城项目\5.png)

![image-20200616204853876](F:\Java书和视频\笔记\商城项目\6.png)

![image-20200616205238788](F:\Java书和视频\笔记\商城项目\7.png)

![image-20200616210017304](F:\Java书和视频\笔记\商城项目\8.png)

## 2、使用Nacos作为微服务的配置中心

[Nacos作为配置中心demo](https://github.com/alibaba/spring-cloud-alibaba/blob/master/spring-cloud-alibaba-examples/nacos-example/nacos-config-example/readme.md)

1. 引入nacos-config-starter
2. 在项目中添加bootstrap.properties配置文件，它的优先级高于其他的配置文件

![image-20200616212736494](F:\Java书和视频\笔记\商城项目\9.png)

![image-20200616212903836](F:\Java书和视频\笔记\商城项目\10.png)

![image-20200616213216214](F:\Java书和视频\笔记\商城项目\11.png)

### Nacos配置中心核心概念

1. 命名空间

   配置隔离

   默认public（保留空间），默认新增的所有配置都在public空间。可以使用命名空间来做环境隔离（生产、测试、开发等环境）

   注意：需要在bootstrap.properties配置上，注明需要使用哪个命名空间下的配置

   还可以基于每一个微服务之间互相隔离配置，每一个微服务都创建自己的命名空间，这样只加载自己命名空间下的配置

2. 配置集：所有的配置的集合

3. 配置集ID：类似于配置文件名

4. 配置分组

   默认所有的配置集都属于：DEFAULT-GROUP

**在项目中，每个微服务创建自己的命名空间，使用配置分组区分环境**

### 同时加载多个配置集

1. 微服务任何配置信息，任何配置文件都可以放在配置中心中

2. 只需要在bootstrap.properties中说明加载配置中心中哪些配置文件即可

3. @Value、@ConfigurationProperties都可以使用

   以前SpringBoot任何方法从配置文件中获取值，都可以使用

   配置中心优先使用配置中心中的值

   ![image-20200616221632358](F:\Java书和视频\笔记\商城项目\12.png)

![image-20200616221805958](F:\Java书和视频\笔记\商城项目\13.png)

## 2、Gateway

网关是流量的入口，常用功能包括**路由转发**、**权限校验**、**限流控制**等。使用SpringCloud gateway作为网关组件

### 使用网关

1. 首先创建一个模块作为网关

![image-20200617201454403](F:\Java书和视频\笔记\商城项目\14.png)

2. 开启服务注册发现



# 第四天、后端服务编写

## 1、菜单三级分类

### 1. 菜单分类表

![image-20200619171911218](F:\Java书和视频\笔记\商城项目\15.png)

我们要根据分类id和父分类id，将商品父类子类树形结构

### 2. 编写分类Controller

![image-20200619172858087](F:\Java书和视频\笔记\商城项目\17.png)

### 3. 编写分类Service

![image-20200619172815067](C:\Users\wyj\AppData\Roaming\Typora\typora-user-images\image-20200619172815067.png)

![image-20200619172936941](F:\Java书和视频\笔记\商城项目\18.png)

### 4. 编写后台管理系统的前端项目，维护三级分类的增删改查

人人快速开发平台-菜单管理-新增目录-新增菜单

![image-20200619173852266](F:\Java书和视频\笔记\商城项目\19.png)

### 5. 在新增的菜单页面显示三级分类

在此省略前端代码

前端向后端发送请求，需要修改请求路径，而且我们应该设置把所有请求发送到网关，再由网关来分发请求。

![image-20200620144341063](F:\Java书和视频\笔记\商城项目\20.png)

还需要在网关中编写如下配置

![image-20200620144622635](F:\Java书和视频\笔记\商城项目\21.png)

如果不进行路径重写，则会出现如下错误

![image-20200620144854494](F:\Java书和视频\笔记\商城项目\22.png)

### 6. 跨域访问

成功获得登录界面后，登录时也会出现异常

![image-20200620145559485](F:\Java书和视频\笔记\商城项目\23.png)

跨域是浏览器对JavaScript施加的一种安全限制，指的是浏览器不能执行其他网站的脚本，它是由浏览器的同源策略造成的。

同源策略：是指协议、域名、端口都要相同，其中一个不相同都会产生跨域

要允许跨域，我们需要在网关项目中添加配置

![image-20200620151718211](F:\Java书和视频\笔记\商城项目\24.png)

## 2、点击按钮删除树形节点

![image-20200620160434347](F:\Java书和视频\笔记\商城项目\25.png)

### 1. 编写Controller

CategoryController中的删除方法：

![image-20200620161513743](F:\Java书和视频\笔记\商城项目\26.png)

### 2. 编写Service

使用逻辑删除（设置删除标志位），使用pms_category表中的show_status作为删除标志位

![image-20200620162021515](F:\Java书和视频\笔记\商城项目\27.png)

1. 配置全局的逻辑删除规则

   ![image-20200620162248253](F:\Java书和视频\笔记\商城项目\28.png)

2. 实体类字段上添加@TableLogic注解（CategoryEntity实体类）（Very Important）

![image-20200620162842444](F:\Java书和视频\笔记\商城项目\29.png)

3. 编写Service中的删除方法

![image-20200620174242147](F:\Java书和视频\笔记\商城项目\30.png)

# JSR-303校验

在Entity类的字段上添加上注解，

![image-20200624214657096](F:\Java书和视频\笔记\商城项目\31.png)



![image-20200624220508845](F:\Java书和视频\笔记\商城项目\32.png)

定义自己的message提示

![image-20200624220923732](F:\Java书和视频\笔记\商城项目\34.png)

还需要在Controller处添加@Valid注解，表明开启校验

![image-20200624220602713](F:\Java书和视频\笔记\商城项目\33.png)

给校验的Bean后紧跟一个BindingResult，就可以获取到校验的结果

![image-20200624221124994](F:\Java书和视频\笔记\商城项目\35.png)

![image-20200625201551175](F:\Java书和视频\笔记\商城项目\36.png)

## 统一的异常处理

使用@ControllerAdvice功能

1. 抽取一个异常处理类

![image-20200625201708734](F:\Java书和视频\笔记\商城项目\37.png)

在Controller中就不用进行异常处理了，如果出现校验错误，SpringMVC会自动帮我们抛出异常，到时上述处理类也就会自动帮我们处理异常，就像上上个图一样。

![image-20200625202513230](F:\Java书和视频\笔记\商城项目\38.png)

大型系统会使用公司规定的异常错误码，会有一个枚举类专门来表示错误码

![image-20200625203849053](F:\Java书和视频\笔记\商城项目\39.png)

## 分组校验

不同的操作对校验规则可能不一样，比如新增品牌不需要携带品牌id，而修改品牌需要携带品牌id，这是就应该使用分组校验

1. 要使用分组校验功能，需要在字段注解中添加groups属性（@NotNull，@NotBlank等注解），也就是标注什么情况需要进行校验

![image-20200625204602133](F:\Java书和视频\笔记\商城项目\40.png)

2. 还需要在Controller上进行标注，告诉Controller改进行哪种校验

![image-20200625204855551](F:\Java书和视频\笔记\商城项目\41.png)

![image-20200625204935496](F:\Java书和视频\笔记\商城项目\42.png)

如果校验注解没有标注分组，那就不起作用了。所以如果Controller中标注了分组，那么其他校验注解也得标注分组

## 自定义校验

1、自己编写一个自定义的校验注解

2、编写一个自定义的校验器

3、让自己编写的校验器校验自定义的校验注解

**自定义校验注解**

![image-20200625211309802](F:\Java书和视频\笔记\商城项目\43.png)

**自定义校验器**

![image-20200625211356255](F:\Java书和视频\笔记\商城项目\44.png)

自定义校验器必须实现ConstraintValidator

# 第五天、SPU和SKU

SPU：Standard Product Unit 标准化产品单元，表示一个商品所有完整信息的聚合（基本属性）

SKU：Stock Keeping Unit 库存量单位（销售属性）

每个分类下的商品共享规格参数，与销售属性。只是有些商品不一定要用这个分类下全部的属性：

* 属性是以三级分类组织起来的
* 规格参数有些是可以提供检索的
* 规格参数也是基本属性，它们具有自己的分组
* 属性的分组也是以三级分类组织起来的
* 属性名是确定的， 但是值有每个具体的商品来决定

## 商品属性分组管理

![image-20200626124840928](F:\Java书和视频\笔记\商城项目\45.png)

![image-20200626124856237](F:\Java书和视频\笔记\商城项目\46.png)

根据所选商品的三级分类id，去数据库中查找相应的属性值

Controller：

![image-20200626125031942](F:\Java书和视频\笔记\商城项目\47.png)

Service：

![image-20200626125719691](F:\Java书和视频\笔记\商城项目\48.png)

修改属性的时候，需要将所属分类进行回显

![image-20200626140041501](F:\Java书和视频\笔记\商城项目\49.png)

![image-20200626140151613](F:\Java书和视频\笔记\商城项目\50.png)

![image-20200626142418037](F:\Java书和视频\笔记\商城项目\51.png)